!function(a){a.fn.cavisor=function(b){var c=a.extend({number:!0,title:!0,arrows:!0,controls:!0,width:900},b),d=0,e=0;return a("img.visor").each(function(){a(this).hasClass("single-image")?(a(this).attr("id","single_visor_"+e+(void 0!=a(this).attr("id")?"-"+a(this).attr("id"):"")),e++):(a(this).attr("id","visor_"+d+(void 0!=a(this).attr("id")?"-"+a(this).attr("id"):"")),d++),a(this).click(function(){function b(b,c,e,f,g,l){function m(){a("body").css("overflow","visible"),a("#visor").remove(),a(document).unbind("keyup")}function n(){var d=h?30:10;a("#visor_border").animate({"margin-top":(a(window).height()-e-30-d-2)/2,height:e+30+d+2,width:c+2},"","",function(){a("#visor_controls_top").css({"margin-top":(a(window).height()-e-30-d-2)/2,"margin-left":(a(window).width()-c-20-2)/2+10}).show(),a("#visor_close").css({"margin-left":c+2-15}),h&&a("#visor_controls_bottom").css({"margin-top":(a(window).height()-e-30-d)/2+e+30,"margin-left":(a(window).width()-c-20-2)/2+10}).show()}),a("#visor_content").height(e).width(c).html('<img src="'+b+'" width="'+c+'" height="'+e+'" class="visor_image" />').fadeIn(1500),k&&a("#visor_next, #visor_prev").show()}function o(){if(e>a(window).height()-100)var b=a(window).height()-100,d=b*c/e;if(c>a(window).width()-100&&d>a(window).width()-100)var d=a(window).width()-100,b=e*d/c;null!=d&&(c=d),null!=b&&(e=b)}function p(){var f=h?30:10;a("#visor_content").fadeOut(200,function(){a("#visor_border").animate({"margin-top":(a(window).height()-e-30-f-2)/2,"margin-left":(a(window).width()-c-20-2)/2,height:e+30+f+2,width:c+2},100,"",function(){j?a("#visor_number").length?a("#visor_number").html(g+1+" / "+d):a('<span id="visor_number">'+(g+1)+" / "+d+"</span>").insertAfter("#visor_close"):a("#visor_number").remove(),void 0!=l.attr("title")&&i?a("#visor_title").length?a("#visor_title").html(l.attr("title")).width(c):a("#visor_controls_top").append('<p id="visor_title">'+l.attr("title")+"</p>"):a("#visor_title").empty(),h?(a("#visor_goto").length?a("#visor_goto").attr("href","#"+l.attr("id")):a("#visor").append('<div id="visor_controls_bottom"><a id="visor_goto" href="#'+l.attr("id")+'">Go to image in the document</a></div>'),a("#visor_controls_bottom").css({"margin-top":(a(window).height()-e-30-f)/2+e+30,"margin-left":(a(window).width()-c-20-2)/2+10}).show()):a("#visor_controls_bottom").remove(),a("#visor_controls_top").css({"margin-top":(a(window).height()-e-30-f-2)/2,"margin-left":(a(window).width()-c-20-2)/2+10}).show(),a("#visor_close").css({"margin-left":c+2-15}),k?(g>=1?(a("#visor_prev").length||(a("#visor_border").prepend('<div id="visor_prev" class="visor_'+(g-1)+'"><span></span></div>'),a("#visor_prev").click(function(){return a("#"+a(this).attr("class")).length>0?a("#"+a(this).attr("class")).trigger("click"):a("img[id^="+a(this).attr("class")+"-]").trigger("click"),!1})),a("#visor_prev").css({"margin-top":(e+2)/2-23.5+30}),a("#visor_prev").attr("class","visor_"+(g-1))):(a("#visor_prev").remove(),a("#visor_prev").unbind("click")),d-1>g?(a("#visor_next").length||(a("#visor_content").before('<div id="visor_next" class="visor_'+(g+1)+'"><span></span></div>'),a("#visor_next").click(function(){return a("#"+a(this).attr("class")).length>0?a("#"+a(this).attr("class")).trigger("click"):a('img[id^="'+a(this).attr("class")+'-"]').trigger("click"),!1})),a("#visor_next").css({"margin-left":c-28,"margin-top":(e+2)/2-23.5+30}),a("#visor_next").attr("class","visor_"+(g+1))):(a("#visor_next").remove(),a("#visor_next").unbind("click"))):a("#visor_prev, #visor_next").remove()}),a("#visor_content").height(e).width(c).html('<img src="'+b+'" width="'+c+'" height="'+e+'" />').fadeIn(200)})}function q(){a("#visor").remove(),a("div.video object").remove(),a("body").css("overflow","hidden").append('<div id="visor"><div id="visor_controls_top"><span id="visor_close">&#10005;</span>'+(j?'<span id="visor_number">'+(g+1)+" / "+d+"</span>":"")+(i&&void 0!=l.attr("title")?'<p id="visor_title">'+l.attr("title")+"</p>":"")+'</div><div id="visor_border">'+(k?(g>=1?'<div id="visor_prev" class="visor_'+(g-1)+'"></div>':"")+(d-1>g?'<div id="visor_next" class="visor_'+(g+1)+'"></div>':""):"")+'<div id="visor_content"></div></div>'+(h?'<div id="visor_controls_bottom"><a id="visor_goto" href="#'+l.attr("id")+'">Go to image in the document</a></div>':"")+"</div>"),a("#visor").height(a(document).height()),a("#visor_prev, #visor_next").css("margin-top",(e+2)/2-23.5+30),a("#visor_next").css("margin-left",c-28),a("#visor_content, #visor_prev, #visor_next").hide(),a("#visor_controls_top, #visor_controls_bottom").width(c+2).hide(),a("#visor_border").width(c+20).css({"margin-top":(a(window).height()-a("#visor_border").height())/2,"margin-left":(a(window).width()-c-20-2)/2}),a("#visor_prev, #visor_next").click(function(){return a("#"+a(this).attr("class")).length>0?a("#"+a(this).attr("class")).trigger("click"):a('img[id^="'+a(this).attr("class")+'-"]').trigger("click"),!1}),a(document).keyup(function(b){switch(b.keyCode){case 37:a("#"+a("#visor_prev").attr("class")).length>0?a("#"+a("#visor_prev").attr("class")).trigger("click"):a('img[id^="'+a("#visor_prev").attr("class")+'-"]').trigger("click");break;case 39:a("#"+a("#visor_next").attr("class")).length>0?a("#"+a("#visor_next").attr("class")).trigger("click"):a('img[id^="'+a("#visor_next").attr("class")+'-"]').trigger("click")}}),n()}a(window).height()>250&&a(window).width()>250?(o(),a("#visor").length?p():q(),a("#visor_close").click(function(){return m(),!1}),a("#visor_goto").click(function(){m()}),a(document).keyup(function(a){(27==a.keyCode||18==a.keyCode||69==a.keyCode||16==a.keyCode||81==a.keyCode)&&m()})):console.log("CAVISOR ERROR: resolution less than 250x250px")}var e=a(this).attr(void 0!=a(this).attr("data-original")?"data-original":"src"),f=parseInt(void 0!=a(this).attr("width")?a(this).attr("width"):a(this).width()),g=parseInt(void 0!=a(this).attr("height")?a(this).attr("height"):a(this).height()),h=a(this).hasClass("no-controls")?!1:c.controls,i=a(this).hasClass("no-title")?!1:c.title,j=a(this).hasClass("no-number")||a(this).hasClass("single-image")?!1:c.number,k=a(this).hasClass("single-image")?!1:c.arrows,l=void 0!=a(this).attr("id")?a(this).attr("id").split("-"):"";if(l.length>1)var m=parseInt(l[1].match(/[\d]+$/)),n=l.length>2?parseInt(l[2].match(/[\d]+$/)):g*m/f;else var m=c.width,n=Math.round(g*m/f);var o=a(this).hasClass("single-image")?0:parseInt(l[0].match(/[\d]+$/)),p=a(this).hasClass("same-image")?e:e.substr(0,e.length-9)+"big."+e.split(".").pop();return b(p,m,n,!0,o,a(this)),!1})})}}(jQuery);